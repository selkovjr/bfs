<!DOCTYPE metadata SYSTEM "metadata.dtd">

<metadata name="dtra">
  <entities>
    <!-- ******************* S A M P L E S ************************ -->
    <class name="samples" group="fact">
      <description>Field sample data</description>
      <source>web submission</source>
      <attribute name="id" type="text" pkey="1">
        <description>sample id</description>
        <source>user input</source>
        <example>217-12181</example>
        <example>DTRA-000001</example>
      </attribute>
      <attribute name="emc_id" type="text">
        <description>EMC Serial No.</description>
        <source>Generated by EMC</source>
        <example>GEORGIA2010_00013</example>
      </attribute>
      <attribute name="date" type="date">
        <description>Sampling date</description>
        <source>user input</source>
      </attribute>
      <attribute name="species" type="int" ref="birds">
        <description>Refernce to Avibase taxonomy</description>
        <source>user input</source>
      </attribute>
      <attribute name="age" type="text">
        <description>Age estimate</description>
        <source>user input</source>
        <values>
adult
subadult
juvenile
first year
second year
        </values>
      </attribute>
      <attribute name="sex" type="char" length="1">
        <description>Sex</description>
        <source>user input</source>
        <values>
F	Female
M	Male
U	Unidentified
        </values>
      </attribute>
      <attribute name="ring" type="text">
        <description>Ring number</description>
        <source>user input</source>
      </attribute>
      <attribute name="clin_st" type="text">
        <description>Clinical status of the bird</description>
        <source>user input</source>
        <values>
normal
abnormal
        </values>
      </attribute>
      <attribute name="vital_st" type="text">
        <description>Vital status of the bird</description>
        <source>user input</source>
        <values>
live
hunted
found dead
        </values>
      </attribute>
      <attribute name="capture_method" type="text">
        <description></description>
        <source>user input</source>
        <values>
trap
mist net
hunted
domestic caught
        </values>
      </attribute>
      <attribute name="location" type="int" ref="locations">
        <description>location id</description>
        <source>user input</source>
      </attribute>
      <attribute name="type" type="text">
        <description>Type of diagnostic sample</description>
        <source>user input</source>
        <values>
tracheal/op swab
cloacal swab
fresh faeces
other
        </values>
      </attribute>
    </class>


    <!-- ***************** S E R A ********************** -->
    <class name="sera" group="reference">
      <description>Serology test</description>
      <source>user input</source>
      <attribute name="sample" type="text" ref="samples">
        <description>sample id </description>
        <comment>Only entered for cloacal samples</comment>
        <source>user input</source>
      </attribute>
      <attribute name="date" type="date">
        <description>Serology testing date</description>
        <source>user input</source>
      </attribute>
      <attribute name="status" type="char" length="1">
        <description>Serology status</description>
        <source>user input</source>
        <values>
+
-
        </values>
      </attribute>
      <attribute name="plate" type="text">
        <description>Serology plate reading</description>
        <source>user input</source>
      </attribute>
    </class>


    <!-- ***************** L O C A T I O N S ********************** -->
    <class name="locations" group="reference">
      <description>Sample collection site</description>
      <source>curator</source>
      <attribute name="id" type="integer" pkey="1" sequence="location_id_seq">
        <description>database key</description>
        <source>sequence</source>
      </attribute>
      <attribute name="name" type="text">
        <description>Name</description>
        <source>user input</source>
      </attribute>
      <attribute name="lat" type="seg">
        <description>Latitude, decimal</description>
        <comment>Require 5 decimal places in the range of -180.00000 .. 180.00000 degrees</comment>
        <source>user input</source>
      </attribute>
      <attribute name="long" type="seg">
        <description>Longitude, decimal</description>
        <comment>Require 5 decimal places in the range of -180.00000 .. 180.00000 degrees</comment>
        <source>user input</source>
      </attribute>
      <init>
1	Alkhasikhe Lake 1	041.1442	43.4600
2	Alkhasikhe Lake 2	041.1980	43.0000
3	Beshkenti	041.7009	46.1512
4	Grigoleti	042.0600	41.7100
5	Heretskari	041.7090	46.0871
6	Hunting shop 1	042.1761	41.7500
7	Jandari Lake	041.4458	45.1988
8	Kazbegi Brewery	041.7118	44.7898
9	Kumisi Lake	041.5849	44.8636
10	Lagodekhi	041.6589	46.1908
11	Lekiani	041.7741	41.9033
12	Napareuli	\N	\N
13	Natanebi	041.7741	41.9033
14	Paliastomi Lake	042.2247	41.9194
15	Ponichala Park	041.6293	44.9307
16	Poti	042.1534	41.6485
17	Pumping station	041.6833	44.8280
18	Rustavi	041.5738	45.0044
19	Tbilisi River	041.6714	44.8441
20	Telavi	041.9674	45.5260
21	village	\N	\N
      </init>
    </class>


    <!-- ******************* D I A G N O S T I C S ************************ -->
    <class name="diagnostics" group="fact">
      <description>Data from the Diagnostic Laboratory</description>
      <source>Web submission</source>
      <attribute name="sample" type="text" ref="samples">
        <description>sample id</description>
        <source>user input</source>
      </attribute>
      <attribute name="rec_date" type="date">
        <description>Date when the sample arrives in the lab</description>
        <source>user input</source>
      </attribute>
      <attribute name="date" type="date">
        <description>TaqMan date</description>
        <source>user input</source>
      </attribute>
      <attribute name="pool" type="int">
        <description>Pool ID</description>
        <source>user input</source>
      </attribute>
      <attribute name="ma_status" type="char" length="1">
        <description>MA status</description>
        <source>user input</source>
        <values>
+	positive
-	negative
        </values>
      </attribute>
      <attribute name="ma_ct" type="text">
        <description>MA Ct value</description>
        <source>user input</source>
      </attribute>
      <attribute name="h5_status" type="char" length="1">
        <description>H5 status</description>
        <source>user input</source>
        <values>
+	positive
-	negative
i	inconclusive
        </values>
      </attribute>
      <attribute name="h5_ct" type="text">
        <description>H5 Ct value</description>
        <source>user input</source>
      </attribute>
      <attribute name="h5_pt" type="text">
        <description>Virus pathotype</description>
        <source>user input</source>
        <values>
HPAI
LPAI
unidentifiable
        </values>
      </attribute>
      <attribute name="h7_status" type="char" length="1">
        <description>H7 status</description>
        <source>user input</source>
        <values>
+	positive
-	negative
i	inconclusive
        </values>
      </attribute>
      <attribute name="h7_ct" type="text">
        <description>H7 Ct value</description>
        <source>user input</source>
      </attribute>
      <attribute name="h7_pt" type="text">
        <description>Virus pathotype</description>
        <source>user input</source>
        <values>
HPAI
LPAI
unidentifiable
        </values>
      </attribute>
      <attribute name="h9_status" type="char" length="1">
        <description>H9 status</description>
        <source>user input</source>
        <values>
+	positive
-	negative
        </values>
      </attribute>
      <attribute name="h9_ct" type="text">
        <description>H9 Ct value</description>
        <source>user input</source>
      </attribute>
    </class>


    <!-- ******************* C U L T U R E S ************************ -->
    <class name="cultures" group="fact">
      <description>Culture test data</description>
      <source>web submission</source>
      <attribute name="sample" type="text" ref="samples">
        <description>sample id</description>
        <source>user input</source>
      </attribute>
      <attribute name="id" type="text">
        <description>AHVLA id</description>
        <comment>AHVLA is the lab that does culture tests</comment>
        <source>user input</source>
      </attribute>
      <attribute name="e1" type="text">
        <description>First egg passage</description>
        <source>user input</source>
      </attribute>
      <attribute name="e2" type="text">
        <description>Second egg passage</description>
        <source>user input</source>
      </attribute>
      <attribute name="isolation" type="bool">
        <description>Isolation successful</description>
        <source>user input</source>
        <values>
t
f
        </values>
      </attribute>
      <attribute name="pathotype" type="text">
        <description>Virus pathotype</description>
        <source>user input</source>
        <values>
HPAI
LPAI
unidentifiable
        </values>
      </attribute>
      <attribute name="ha_subtype" type="text">
        <description>Haemagglutinin subtype</description>
        <source>user input</source>
      </attribute>
      <attribute name="na_subtype" type="text">
        <description>Neuraminidase subtype</description>
        <source>user input</source>
      </attribute>
    </class>


    <!-- ******************* S E Q U E N C E ************************ -->
    <class name="sequences" group="fact">
      <description>Sample sequence data</description>
      <source>web submission</source>
      <attribute name="sample" type="text" ref="samples">
        <description>sample id</description>
        <source>user input</source>
      </attribute>
      <attribute name="segment" type="text">
        <description>RNA segment</description>
        <source>user input</source>
        <values>
PB2
PB1
PA
HA
NP
NA
MA
NS
        </values>
      </attribute>
      <attribute name="data" type="text">
        <description>DNA/RNA Sequence</description>
        <source>user input</source>
      </attribute>
    </class>

    <!-- ******************* B I R D S ************************ -->
    <class name="birds" group="reference">
      <description>Bird taxonomy</description>
      <source>Imported from Avibase via NFB-DB_SpecList_final</source>
      <attribute name="id" type="int" pkey="1">
        <description>Avibase id (wbdb)</description>
        <source>NFB-DB_SpecList_final.tab</source>
      </attribute>
      <attribute name="family" type="text">
        <description>Family</description>
        <source>NFB-DB_SpecList_final.tab</source>
      </attribute>
      <attribute name="genus" type="text">
        <description>Genus</description>
        <source>NFB-DB_SpecList_final.tab</source>
      </attribute>
      <attribute name="species" type="text">
        <description>Species</description>
        <source>NFB-DB_SpecList_final.tab</source>
      </attribute>
      <attribute name="name" type="text">
        <description>Sceintific name</description>
        <source>NFB-DB_SpecList_final.tab</source>
      </attribute>
      <attribute name="common_name" type="text">
        <description>Common name</description>
        <source>NFB-DB_SpecList_final.tab</source>
      </attribute>
    </class>

    <!-- *********************** A C ************************** -->
    <class name="ac" group="reference">
      <description>Autocomplete values for the GUI</description>
      <source>schema</source>
      <attribute name="class" type="text">
        <description>Database class (table)</description>
        <source>schema</source>
      </attribute>
      <attribute name="attr" type="text">
        <description>Class attribute</description>
        <source>schema</source>
      </attribute>
      <attribute name="ord" type="int">
        <description>Ordinal number in the list of values</description>
        <source>schema</source>
      </attribute>
      <attribute name="val" type="text">
        <description>Autocomplete option</description>
        <source>schema</source>
      </attribute>
      <attribute name="desc" type="text">
        <description>Human-readable description of the option</description>
        <source>schema</source>
      </attribute>
    </class>
  </entities>
  <extensions>
CREATE EXTENSION SEG;
  </extensions>
  <constraints>
  </constraints>
  <functions>
ALTER SEQUENCE location_id_seq RESTART WITH 22;

CREATE VIEW v_samples_birds_cn AS
  SELECT s.id,
         s.emc_id,
         s.date,
         b.common_name AS bird,
         s.age,
         s.sex,
         s.ring,
         s.clin_st,
         s.vital_st,
         s.capture_method,
         s.location,
         s.type
    FROM samples s LEFT OUTER JOIN birds b
      ON b.id = s.species;
  </functions>
</metadata>
